<script>
    // Random tips and statistics that rotate on page load
    const datingTips = [
        "Messages with questions get 15% more responses than statements",
        "Photos with genuine smiles get 23% more matches than posed shots",
        "Tuesday at 9pm has the highest response rate on dating apps",
        "Mentioning specific details from their profile increases response rates by 30%",
        "Humor beats pickup lines - funny messages get 3x more replies",
        "People are 40% more likely to respond to messages under 60 characters",
        "Messages sent between 8-10pm get the most responses",
        "Using their name in a message increases reply rates by 20%",
        "Asking about their interests gets better responses than complimenting appearance",
        "Messages with emojis get 25% fewer responses from people over 30",
        "Sunday has the lowest competition - fewer people messaging",
        "People swipe fastest between 6-9pm on weekdays",
        "References to shared interests increase match quality by 45%",
        "Open-ended questions work better than yes/no questions",
        "Confidence is 67% more attractive than modesty in opening messages"
    ];
    
    // Set random tip on page load
    function setRandomTip() {
        const tipElement = document.getElementById('randomTip');
        if (tipElement) {
            tipElement.textContent = datingTips[Math.floor(Math.random() * datingTips.length)];
        }
    }
    
    // Update active users counter with random fluctuation
    function updateActiveUsers() {
        const minUsers = 89;
        const maxUsers = 847;
        const newCount = Math.floor(Math.random() * (maxUsers - minUsers + 1)) + minUsers;
        document.getElementById('activeUsers').textContent = newCount;
    }
    
    // Set initial random count on load
    document.addEventListener('DOMContentLoaded', function() {
        setRandomTip();
        updateActiveUsers();
    });
    
    // Update every 8-25 seconds for more realistic feel
    setInterval(updateActiveUsers, Math.random() * 17000 + 8000);

    document.getElementById('messageForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const yourGender = document.getElementById('yourGender').value;
        const theirGender = document.getElementById('theirGender').value;
        const platform = document.getElementById('platform').value;
        const personality = document.getElementById('personality').value;
        const target = document.getElementById('target').value;
        const appearance = document.getElementById('appearance').value;
        const messageType = document.getElementById('messageType').value;
        const context = document.getElementById('context').value;
        
        if (!yourGender || !theirGender || !platform) {
            alert('Please select your gender, their gender, and the platform to generate the best message');
            return;
        }
        
        // Check for same-sex combinations (gAy-I mode)
        const isGayMode = (yourGender === theirGender) || 
                         (yourGender === 'male' && theirGender === 'male') || 
                         (yourGender === 'female' && theirGender === 'female');
        
        // Show loading
        document.getElementById('loading').style.display = 'block';
        document.getElementById('result').style.display = 'none';
        
        // Call your real API
        try {
            const response = await fetch('/api/generate-message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    yourGender,
                    theirGender,
                    platform,
                    personality,
                    target,
                    appearance,
                    messageType,
                    context
                }),
            });

            const data = await response.json();
            
            if (data.success) {
                const messageElement = document.getElementById('generatedMessage');
                const disclaimerElement = document.getElementById('disclaimer');
                const gayModeElement = document.getElementById('gayModeIndicator');
                
                messageElement.textContent = data.message;
                
                // Handle gay mode styling
                if (isGayMode) {
                    messageElement.classList.add('rainbow-text');
                    gayModeElement.style.display = 'block';
                } else {
                    messageElement.classList.remove('rainbow-text');
                    gayModeElement.style.display = 'none';
                }
                
                // Handle unhinged disclaimer
                if (['chaotic', 'unhinged', 'crackhead', 'alien', 'serial_killer', 'time_traveler'].includes(personality)) {
                    messageElement.classList.add('unhinged');
                    disclaimerElement.style.display = 'block';
                } else {
                    messageElement.classList.remove('unhinged');
                    disclaimerElement.style.display = 'none';
                }
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            } else {
                throw new Error(data.error || 'Generation failed');
            }
        } catch (error) {
            document.getElementById('loading').style.display = 'none';
            alert('Error generating message: ' + error.message);
            console.error('Full error:', error);
        }
    });
    
    document.getElementById('copyBtn').addEventListener('click', function() {
        const message = document.getElementById('generatedMessage').textContent;
        navigator.clipboard.writeText(message).then(() => {
            this.textContent = 'âœ… Copied!';
            setTimeout(() => {
                this.textContent = 'ðŸ“‹ Copy Message';
            }, 2000);
        });
    });
</script>
